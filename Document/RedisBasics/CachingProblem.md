## 三大缓存问题
注意: 这部分内容作为选学内容

虽然我们可以利用缓存来大幅度提升我们程序的数据获取效率 但是使用缓存也存在着一些潜在的问题

### 缓存穿透
<img src="https://image.itbaima.cn/markdown/2023/08/14/fSDgVrZj2ozKuPG.png"/>

当我们去查询一个一定不存在的数据 比如Mybatis在缓存是未命中的情况下需要从数据库查询 查不到数据则不写入缓存 这将导致这个不存在的数据每次请求都要到数据库去查询 造成缓存穿透

这显然是很浪费资源的 我们希望的是 如果这个数据不存在 为什么缓存这一层不直接返回空呢 这时就不必再去查数据库了 但是也有一个问题 缓存不去查数据库怎么知道数据库里面到底有没有这个数据呢?

这时我们就可以使用布隆过滤器来进行判断 什么是布隆过滤器?(当然不是打辅助的那个布隆 只不过也挺像 辅助布隆也是挡子弹的)

<img src="https://image.itbaima.cn/markdown/2023/03/06/vWaLugBJMT3zIDC.jpg"/>

使用布隆过滤器 能够告诉你某样东西一定不存在或是某样东西可能存在

布隆过滤器本质上是一个存放二进制位的bit数组 如果我们要添加一个值到布隆过滤器中 我们需要使用N个不同的哈希函数来生成N个哈希值 并对每个生成的哈希值指向的bit位置1 如上图所示 一共添加了三个值abc

接着我们给一个d 那么这时就可以进行判断 如果说d计算的N个哈希值的位置上都是1 那么就说明d可能存在 这时候又来了个e 计算后我们发现有一个位置上的值是0 这时就可以直接断定e一定不存在

### 缓存击穿
<img src="https://image.itbaima.cn/markdown/2023/03/06/6ut3ClgQrWUfKy2.png"/>

某个Key属于热点数据 访问非常频繁 同一时间很多人都在访问 在这个Key失效的瞬间 大量的请求到来 这时发现缓存中没有数据 就全都直接请求数据库 相当于击穿了缓存屏障 直接攻击整个系统核心

这种情况下 最好的解决办法就是不让Key那么快过期 如果一个Key处于高频访问 那么可以适当地延长过期时间

### 缓存雪崩
<img src="https://image.itbaima.cn/markdown/2023/03/06/BwncOXbRU4WFgkV.png"/>

当你的Redis服务器炸了或是大量的Key在同一时间过期 这时相当于缓存直接GG了 那么如果这时又有很多的请求来访问不同的数据
同一时间内缓存服务器就得向数据库大量发起请求来重新建立缓存 很容易把数据库也搞GG

解决这种问题最好的办法就是设置高可用 也就是搭建Redis集群 当然也可以采取一些服务熔断降级机制 这些内容我们会在SpringCloud阶段再进行探讨